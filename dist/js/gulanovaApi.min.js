async function callOsuApi(e){const o=localStorage.getItem("access_token"),t=await fetch(`https://gulanova-auth.vercel.app/api/osuApi?endpoint=${encodeURIComponent(e)}`,{method:"GET",headers:{Authorization:`Bearer ${o}`}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return t.json()}async function fetchUserRole(){try{const e=localStorage.getItem("username_desktop");if(!e)return void console.error("No logged-in username found.");const o=window.location.pathname,t=`${o}/json/users-data.json`,r=await fetch(t);if(!r.ok)throw new Error(`Error fetching JSON file: ${r.status}`);const a=await r.json(),n=a.find(o=>o.username===e);if(!n)return void console.error("User not found in JSON.");const s=n.role,c=document.getElementById("user-role-desktop");c.textContent="player"===s?"You are: PLAYER":s?"You are: STAFF":"You are: VISITOR"}catch(e){console.error("Error processing user role:",e)}try{const e=localStorage.getItem("username_mobile");if(!e)return void console.error("No logged-in username found.");const o=window.location.pathname,t=`${o}/json/users-data.json`,r=await fetch(t);if(!r.ok)throw new Error(`Error fetching JSON file: ${r.status}`);const a=await r.json(),n=a.find(o=>o.username===e);if(!n)return void console.error("User not found in JSON.");const s=n.role,c=document.getElementById("user-role-mobile");c.textContent="player"===s?"You are: PLAYER":s?"You are: STAFF":"You are: VISITOR"}catch(e){console.error("Error processing user role:",e)}}function testistwo(){console.log(callOsuApi("/me/osu"))}function deb(){const e=window.location.href,o=e.match(/code=(.*$)/)[1];console.log(o)}window.onload=async function(){await fetchUserRole();const e=new URLSearchParams(window.location.search),o=e.get("code"),t=localStorage.getItem("access_token"),r=window.location.pathname;if(o)try{const e=await axios.get(`https://gulanova-auth.vercel.app/api/osuAuth?code=${o}`);e.data.access_token&&(localStorage.setItem("access_token",e.data.access_token),window.location.href=r)}catch(e){console.error("Error during OAuth token exchange:",e)}else if(t){try{const e=document.getElementById("avatar_mobile"),o=localStorage.getItem("avatar_url");if(o)e.src=o;else{const o=await callOsuApi("/me/osu");e.src=o.avatar_url,localStorage.setItem("avatar_url",o.avatar_url),localStorage.setItem("username",o.username)}}catch(e){console.error("Error fetching user data:",e)}finally{document.getElementById("login-desktop").classList.add("hidden"),document.getElementById("logout-desktop").classList.remove("hidden"),document.getElementById("username-desktop").innerHTML=localStorage.getItem("username")}try{const e=document.getElementById("avatar_desktop"),o=localStorage.getItem("avatar_url");if(o)e.src=o;else{const o=await callOsuApi("/me/osu");e.src=o.avatar_url,localStorage.setItem("avatar_url",o.avatar_url),localStorage.setItem("username",o.username)}}catch(e){console.error("Error fetching user data:",e)}finally{document.getElementById("login-mobile").classList.add("hidden"),document.getElementById("logout-mobile").classList.remove("hidden"),document.getElementById("username-mobile").innerHTML=localStorage.getItem("username")}}else console.error("No access token or OAuth code found")};